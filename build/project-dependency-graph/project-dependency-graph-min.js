YUI.add("project-dependency-graph",function(e){var t,n=e.Object,r=e.DataType.Date;t=function(){},t.prototype={addOutgoingTransition:function(e,t,n){var r=this,i=r.dependencyGraph,s=i.transitions,o=s.incoming,u=s.outgoing,a;a=u[e]||{},a[t]={type:n},u[e]=a,a=o[t]||{},a[e]={type:n},o[t]=a},removeOutgoingTransition:function(e,t){var r=this,i=r.dependencyGraph,s=i.transitions,o=s.incoming,u=s.outgoing,a;a=u[e],delete a[t],n.isEmpty(a)&&delete u[e],a=o[t],delete a[e],n.isEmpty(a)&&delete o[t]},deleteNode:function(e){var t=this,r=t.dependencyGraph,i=r.transitions,s=i.incoming,o=i.outgoing,u;u=o[e],n.each(u,function(t,r,i){delete s[r][e],n.isEmpty(s[r])&&delete s[r]}),u&&delete o[e],u=s[e],n.each(u,function(t,r,i){delete o[r][e],n.isEmpty(o[r])&&delete o[r]}),u&&delete s[e]},calculateSchedule:function(t){this.resetGraph();var i=new Date,s=this,o=s.dependencyGraph,u=o.transitions,a=u.incoming,f=u.outgoing,l=new e.Queue,c,h,p,d,v=t.getByClientId("task_0").get("startDate"),m,g,y,b;l.add("task_0");while(l.size()>0)c=l.next(),y=t.getByClientId(c),b=y.get("children").size(),m=v,g=v,sendDependentEndDate=!0,d=!0,p=a[c],n.each(p,function(e,t,n){!p.successorStartDateSent&&d&&(e.type==="SD_SD"||e.type==="ED_SD"||e.type==="RES_ED_SD")&&(e.done?r.isGreater(e.value,m)&&(m=e.value,n.winner=e):d=!1),e.type==="ED_ED"&&(e.done?r.isGreater(e.value,g)&&(g=e.value):sendDependentEndDate=!1)}),sendDependentEndDate&&!p.dependentEndDateSent&&b&&(y.set("endDate",g,{silent:!0}),p.dependentEndDateSent=!0),d&&!p.successorStartDateSent&&(p.successorStartDateSent=!0,y.set("startDate",m,{silent:!0}),b||(g=e.ProjectCalendar.calcTaskEndDateWithResourceFromScratch(t.getByClientId(c)))),h=f[c],n.each(h,function(e,t,n){n=a[t][c],n.done||(n.type==="SD_SD"&&d&&(n.done=!0,n.value=m,l.demotePush(t)),(n.type==="ED_SD"||n.type==="RES_ED_SD"||n.type==="ED_ED")&&d&&sendDependentEndDate&&(n.done=!0,n.value=g,l.demotePush(t)))});var w=new Date},resetGraph:function(){var e=this,t=e.dependencyGraph,r=t.transitions,i=r.incoming;n.each(i,function(e,t){delete e.dependentEndDateSent,delete e.successorStartDateSent,n.each(e,function(e,t){delete e.value,delete e.done})})},processTaskForSchedule:function(e,t,i,s,o){var u=t.getChildCount(),a=!0,f=i.incoming[e],l,c;n.each(f,function(e,t,n){if(!n.startDateKnown)if(!e.done||e.type!=="SD_SD"&&e.type!=="ED_SD")(e.type==="SD_SD"||e.type==="ED_SD")&&!e.done&&(a=!1);else if(!l||r.isGreater(e.value,l))l=e.value}),a&&!f.startDateKnown&&(f.startDateKnown=!0,t.set("startDate",l),u||(c=s.calcTaskEndDateWithResourceFromScratch(t),t.set("endDate",c)))}},e.ProjectDependencyGraph=new t});
