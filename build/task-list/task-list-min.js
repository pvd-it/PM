YUI.add("task-list",function(e){var t=e.Array,n=e.Object,r=8;e.TaskList=e.Base.create("taskList",e.TreeModelList,[e.ModelListVariance],{initializer:function(){this.model=e.Task,this.after("task:change",this._taskChangeInterceptor)},indent:function(t){var n=this,r=e.TreeModelList.prototype.indent.apply(n,arguments);if(r){var i=r.get("work");r.get("children").size()===1&&(n._updateAncestorsWork(r,0-i),i=0),i+=t.get("work"),r.set("work",i,{silent:!0})}},outdent:function(t){var n=this,i=n.getByClientId(t.get("parent")),s=t.get("work"),o;o=e.TreeModelList.prototype.outdent.apply(n,arguments);if(o)if(i.get("children").size()===0)i.set("work",r,{silent:!0}),n._updateAncestorsWork(i,r);else{var u=i.get("work");u-=s,i.set("work",u,{silent:!0})}},_addInterceptor:function(t){if(t.index===0&&this.size()>0){t.halt(),e.fire("alert",{type:"info",message:"You are trying to insert a task before first task, which represents the entire project. A task can not be inserted before project task."});return}var n=t.model.get("clientId");if(n==="task_0")return;var r=this._findCandidParent(t.model,t.index);r=r?r:this.item(0),this._changeParent(t.model,r);if(r){var i=r.get("work"),s=t.model.get("work");i+=s,r.set("work",i,{silent:!0}),this._updateAncestorsWork(r,s)}},_removeInterceptor:function(t){var n=t.model.get("clientId");if(n==="task_0"){t.halt(),e.fire("alert",{type:"info",message:"You are trying to delete very first task, which represents the entire project. This task can not be deleted."});return}var i=t.model.get("parent");e.TreeModelList.prototype._removeInterceptor.apply(this,arguments);if(i){var s=this.getByClientId(i),o=s.get("work"),u=0-t.model.get("work");o+=u,s.set("work",o,{silent:!0}),s.get("children").size()===0&&i!=="task_0"&&(u+=r,o=r,s.set("work",o,{silent:!0})),this._updateAncestorsWork(s,u)}e.ProjectDependencyGraph.deleteNode(n)},_taskChangeInterceptor:function(e){var t=e.target,n=this;e.changed.resources&&n._handleResourcesChange(e),e.changed.startDate&&this._handleStartDateChange(t,e.changed.startDate.newVal,e.changed.startDate.prevVal),e.changed.work&&this._handleWorkChange(t,e.changed.work.newVal,e.changed.work.prevVal),e.changed.predecessors&&this._handlePredecessorsChange(t,e.changed.predecessors.newVal,e.changed.predecessors.prevVal)},_handleResourcesChange:function(e){var n=e.target,r=[],i=this;t.each(e.resourcesAdded,function(e){t.each(e.get("assignedTasks"),function(e){r.push(i.getByClientId(e))})})},_handlePredecessorsChange:function(t,r,i){var s=this,o=t.get("clientId");i&&n.each(i.FS,function(t,n){e.ProjectDependencyGraph.removeOutgoingTransition(n,o)}),r&&n.each(r.FS,function(t,n){e.ProjectDependencyGraph.addOutgoingTransition(n,o,"ED_SD")})},_handleWorkChange:function(e,t,n){var r=t-n,i=this;i._updateAncestorsWork(e,r)},_handleStartDateChange:function(e,t,n){},_updateAncestorsWork:function(e,t){var n=this,r=n.getByClientId(e.get("parent"));while(r){var i=r.get("work");i+=t,r.set("work",i,{silent:!0}),r=n.getByClientId(r.get("parent"))}}})});
