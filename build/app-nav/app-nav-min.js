YUI.add("app-nav",function(e){var t;e.namespace("PMApp").Nav=t=function(){},t.prototype={template:'<ul class="nav"><li><a href="/dashboard">Dashboard</a></li><li><a href="/newproject">New Project</a></li></ul><form method="GET" action="/logout" class="pull-right navbar-form"><button class="btn btn-danger"><i class="icon-white icon-share"></i> Logout</button></form><ul class="nav pull-right"><li><a href="/help"><i class="icon-bell icon-white"> </i> Help</a></li><li><a href="/usersettings"><i class="icon-user icon-white"> </i> {name}</a></li></ul>',projectNavTemplate:'<ul class="nav"><li class="active"><a href="/project/{id}/overview">Overview</a></li><li><a href="/project/{id}/schedule">Schedule</a></li><li><a href="/project/{id}/gantt">Gantt</a></li><li><a href="/project/{id}/resource">Team</a></li><li><a href="/project/{id}/workflow">Workflow</a></li></ul>',initializer:function(){var t=this;e.Do.after(t._setupNav,t,"render"),t.after("loginSuccess",e.bind(t._afterLoginSuccessNav,t)),t.after("currentProjectChange",t._afterCurrentProjectChangeNav),t.after("activeViewChange",t._afterActiveViewChangeNav)},_setupNav:function(){var t=this;t.pageHeader=e.one(".page-header"),t.primaryNav=e.one("#primaryNav"),t.secondaryNav=e.one(".secondary .navbar"),t.get("isAuthenticated")?(t._setUser(t.get("currentUser")),t._setUpViewContainer()):t.primaryNav.one("form").on("submit",t._handleSubmission,t)},_setUpViewContainer:function(){e.one(".main").all("div").remove(),e.one(".secondary").removeClass("hide"),e.one("body").addClass("checker-body")},_handleSubmission:function(e){var t=e.target,n=t.one('input[type="text"]').get("value"),r=t.one('input[type="password"]').get("value");e.halt(),this.doLogin(n,r)},_afterLoginSuccessNav:function(e){var t=this;t._setUpViewContainer(),t._setUser(e.user)},_setUser:function(t){var n=this;e.one(".main").addClass("container"),n.primaryNav.one("form").remove(),n.primaryNav.one(".nav-collapse").set("innerHTML",e.substitute(n.template,t))},_afterCurrentProjectChangeNav:function(t){var n=this,r=t.newVal.get("_id");n.secondaryNav.one(".project-name > a").set("innerHTML",'<i class="icon-gift"> </i> '+t.newVal.get("name")+'<b class="caret"></b>'),n.secondaryNav.one(".project-links").set("innerHTML",e.substitute(n.projectNavTemplate,{id:r}))},_secondaryNavScrollSnapped:function(t){this.secondaryNav.addClass("navbar-fixed-top"),e.one(".secondary").addClass("scroll-snapped")},_secondaryNavScrollUnsnapped:function(t){this.secondaryNav.removeClass("navbar-fixed-top"),e.one(".secondary").removeClass("scroll-snapped")},_afterActiveViewChangeNav:function(t){var n=this,r=n.getViewInfo(t.newVal),i,s;r.subNav?(n.secondaryNav.removeClass("hide"),n.secondaryNav.plug(e.ScrollSnapPlugin,{scrollOffset:70}),n.secondaryNav.ssp.on("scrollSnapped",e.bind(n._secondaryNavScrollSnapped,n)),n.secondaryNav.ssp.on("scrollUnsnapped",e.bind(n._secondaryNavScrollUnsnapped,n))):(n.secondaryNav.addClass("hide"),n.secondaryNav.unplug("ssp")),r.pageHeader?(n.pageHeader.set("innerHTML","<h1>"+r.pageHeader+" <small>"+r.pageHeaderTeaser+"</small></h1>"),n.pageHeader.removeClass("hide")):n.pageHeader.addClass("hide"),s=n.secondaryNav.one('a[href="'+window.location.pathname+"]");if(s){i=n.secondaryNav.one(".active"),i&&i.removeClass("active"),s.get("parentNode").addClass("active");return}s=n.primaryNav.one('a[href="'+window.location.pathname+"]"),s&&(i=n.primaryNav.one(".active"),i&&i.removeClass("active"),s.get("parentNode").addClass("active"))}}});
