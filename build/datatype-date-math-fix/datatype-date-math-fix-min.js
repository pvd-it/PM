YUI.add("datatype-date-math-fix",function(e){e.mix(e.namespace("DataType.Date"),{difference:function(e,t,n){t=t||new Date,n=n||"day";var r=t.getFullYear()-e.getFullYear(),i=1;switch(n){case"quarter":var s=e.getMonth(),o=t.getMonth(),u=Math.floor(s/3)+1,a=Math.floor(o/3)+1;a+=r*4,i=a-u;break;case"weekday":var f=Math.round(dojo.date.difference(e,t,"day")),l=parseInt(dojo.date.difference(e,t,"week"),10),c=f%7;if(c===0)f=l*5;else{var h=0,p=e.getDay(),d=t.getDay();l=parseInt(f/7,10),c=f%7;var v=new Date(e);v.setDate(v.getDate()+l*7);var m=v.getDay();if(f>0)switch(!0){case p===6:h=-1;break;case p===0:h=0;break;case d===6:h=-1;break;case d===0:h=-2;break;case m+c>5:h=-2}else if(f<0)switch(!0){case p===6:h=0;break;case p===0:h=1;break;case d===6:h=2;break;case d===0:h=1;break;case m+c<0:h=2}f+=h,f-=l*2}i=f;break;case"year":i=r;break;case"month":i=t.getMonth()-e.getMonth()+r*12;break;case"week":i=parseInt(dojo.date.difference(e,t,"day")/7,10);break;case"day":i/=24;case"hour":i/=60;case"minute":i/=60;case"second":i/=1e3;case"millisecond":i*=t.getTime()-e.getTime()}return Math.round(i)}})});
