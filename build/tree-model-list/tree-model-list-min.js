YUI.add("tree-model-list",function(e){var t=e.Array;e.TreeModelList=e.Base.create("treeModelList",e.ModelList,[],{deletedItems:[],model:e.TreeModel,initializer:function(){this.on("add",this._addInterceptor),this.on("remove",this._removeInterceptor),this.on("*:depthLevelChange",this._childDepthChanging),this.after("*:collapsedChange",this._childCollapsedChanged),this.after("reset",this._afterReset)},indent:function(e){var t=this,n=t.indexOf(e),r=e.get("parent"),i,s;for(s=n-1;s>=0;s--){i=t.item(s);if(r===i.get("parent")){this._changeParent(e,i);break}i=undefined}return i},outdent:function(e){var n=this,r=e.get("parent"),i,s,o;if(r){o=n.getByClientId(r),i=o.get("parent");if(i){s=n.getByClientId(i);var u=this._changeParent(e,s);n.remove(u,{silent:!0});var a=n.indexOf(o),f=[],l;return this._findDescendants(o,f),l=a+f.length+1,t.each(u,function(e,t){n.add(e,{index:l+t,silent:!0})}),s}}},_changeParent:function(t,n){var r=t.get("parent"),i=t.get("clientId"),s,o=this,u,a,f=n.get("clientId");r&&(s=o.getByClientId(r),s.get("children").remove(i),e.ProjectDependencyGraph.removeOutgoingTransition(r,i),e.ProjectDependencyGraph.removeOutgoingTransition(i,r)),a=n.get("depthLevel")+1-t.get("depthLevel"),u=!n.get("collapsed");var l=[];return l.push(t),this._findDescendants(t,l),e.Array.each(l,function(e){var t=e.get("depthLevel");t=parseInt(t,10)+a,e.set("depthLevel",t,{silent:!0}),u||e.set("visible",u,{silent:!0})}),n.get("children").add(i),t.set("parent",f,{silent:!0}),e.ProjectDependencyGraph.addOutgoingTransition(f,i,"SD_SD"),e.ProjectDependencyGraph.addOutgoingTransition(i,f,"ED_ED"),l},_childCollapsedChanged:function(e){var t=e.target;e.newVal?this._collapseNode(this,t):this._expandNode(this,t)},_collapseNode:function(e,t){t.get("children").each(function(t){var n=e.getByClientId(t);n.set("visible",!1,{silent:!0}),this._collapseNode(e,n)},this)},_expandNode:function(e,t){t.get("children").each(function(t){var n=e.getByClientId(t);n.set("visible",!0,{silent:!0}),n.get("collapsed")||this._expandNode(e,n)},this)},_addInterceptor:function(e){var t=this._findCandidParent(e.model,e.index);t&&this._changeParent(e.model,t)},_removeInterceptor:function(e){var n=[],r=e.model.get("clientId"),i=e.model.get("parent"),s=this.getByClientId(i);s&&s.get("children").remove(r),this._findDescendants(e.model,n),this.remove(n,{silent:!0}),n.push(e.model),t.each(n,function(e){e.isNew()||this.deletedItems.push(e)},this)},_findDescendants:function(e,t){e.get("children").each(function(e){var n=this.getByClientId(e);t.push(n),this._findDescendants(n,t)},this)},_findCandidParent:function(e,t){var n=this.item(t-1),r=n?n.get("parent"):undefined;return r?this.getByClientId(r):r},_afterReset:function(e){this.deletedItems.length=0}})});
