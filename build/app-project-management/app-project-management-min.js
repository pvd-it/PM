YUI.add("app-project-management",function(e){var t;e.namespace("ProjectManagement"),e.ProjectManagement.App=t=e.Base.create("appProjectManagement",e.App,[e.App.Dropdown,e.PMApp.Nav,e.PMApp.Login,e.AppBaseFix,e.App.AlertBoard,e.App.DialogManager],{views:{login:{type:e.PMApp.LoginView,preserve:!1},logout:{type:e.PMApp.LogoutView,preserve:!1,pageHeader:"Logout",pageHeaderTeaser:" is successful, so you are"},project:{type:e.PMApp.ProjectView,preserve:!1,pageHeader:"Overview",pageHeaderTeaser:"",subNav:!0},schedule:{type:e.PMApp.ScheduleView,preserve:!1,parent:"login",pageHeader:"Schedule",pageHeaderTeaser:"",subNav:!0},resource:{type:e.PMApp.ResourceView,preserve:!1,parent:"schedule",pageHeader:"Team",pageHeaderTeaser:"",subNav:!0},gantt:{type:e.PMApp.GanttView,preserve:!1,parent:"schedule",pageHeader:"Gantt",pageHeaderTeaser:"",subNav:!0},newproject:{type:e.PMApp.NewProjectView,preserve:!1,pageHeader:"Create a Project",pageHeaderTeaser:"to manage it better"},dashboard:{type:e.PMApp.DashboardView,preserve:!1,pageHeader:"Dashboard",pageHeaderTeaser:"is where you see all your projects, tasks and notifications"},usersettings:{type:e.PMApp.UserSettingsView,preserve:!0,pageHeader:"Personalize",pageHeaderTeaser:"to your own preferences"},workflow:{type:e.PMApp.WorkflowView,preserve:!1,pageHeader:"Workflow",pageHeaderTeaser:"visualizes project",subNav:!0}},initializer:function(){var t=this;t.after("loginSuccess",t._afterLoginSuccess),t.after("currentUserChange",t._afterCurrentUserChange),t.after("currentProjectChange",t._afterCurrentProjectChange),t.on("*:editProjectOverview",t._onEditProjectOverview),t.on("*:projectCreated",t._onProjectCreateUpdate),t.on("*:projectUpdated",t._onProjectCreateUpdate),e.after("projectActions:appAction",e.bind(t._performProjectAction,t))},showView:function(t){var n=this,r=n.views[t]&&n.views[t].pageHeader,i=n.views[t]&&n.views[t].pageHeaderTeaser,s;r&&(s="<h1>"+r+" ",i&&(s=s+"<small>"+i+"</small>"),s+="</h1>"),e.AppBaseFix.prototype.showView.apply(this,arguments)},render:function(){t.superclass.render.apply(this,arguments)},_performProjectAction:function(t){if(t.confirmationRequired&&!t.hasConfirmation)return;var n=this;switch(t.action){case"save":n._saveCurrentProject(t);break;case"discard":n._reloadCurrentProject(t);break;case"export":n._exportCurrentProject(t);break;case"delete":n._deleteCurrentProject(t);break;case"schedule":e.ProjectDependencyGraph.calculateSchedule(n.get("currentProject").get("tasks"))}},_reloadCurrentProject:function(t){var n=this;n.get("currentProject").load(function(t,n){if(t){e.fire("alert",{type:"error",message:"Unable to load project. Please try again."});return}e.fire("alert",{type:"warning",message:"Discarded changes made. Project has been reloaded."})})},_exportCurrentProject:function(e){var t=this,n=t.get("currentProject").serialize()},_deleteCurrentProject:function(t){var n=this;n.get("currentProject").destroy({remove:!0},function(t,n){t?e.fire("alert",{type:"error",message:"Some error occured while removing the project. Server returned: "+t}):e.fire("alert",{type:"info",message:"Project was deleted successfullly"})})},_saveCurrentProject:function(t){var n=this;n.get("currentProject").save(function(t,n){t?e.fire("alert",{type:"error",message:"Some error occured while saving the project. Server returned: "+t}):e.fire("alert",{type:"success",message:"Project saved successfullly"})})},_afterLoginSuccess:function(e){this.set("currentUser",e.user),this.replace("/dashboard")},_afterCurrentUserChange:function(e){this.isAuthenticated=!0},_afterCurrentProjectChange:function(e){var t=e.newVal,n=this,r=n.views,i="";t&&(i="of "+t.get("name")),r.project.pageHeaderTeaser=r.schedule.pageHeaderTeaser=r.resource.pageHeaderTeaser=r.gantt.pageHeaderTeaser=i},_onEditProjectOverview:function(e){this.save("/project/edit")},_onProjectCreateUpdate:function(t){this.save("/project/"+t._id),t.type==="newProjectView:projectUpdated"?e.fire("alert",{type:"success",message:"Project saved successfully",preserveOnce:!0}):t.type==="newProjectView:projectCreated"&&e.fire("alert",{type:"success",message:"Project created successfully",preserveOnce:!0})},showScheduleView:function(e,t){this.showView("schedule",{model:this.get("currentProject")}),this.get("activeView").moveFocusToTable()},showResourceView:function(e,t){this.showView("resource",{model:this.get("currentProject")}),this.get("activeView").moveFocusToTable()},showGanttView:function(e,t){this.showView("gantt",{model:this.get("currentProject")})},showLoginView:function(){this.isAuthenticated?e.fire("alert",{type:"error",message:"You are already authenticated. If you typed <strong>/login</strong> in browser then you know what your are doing..."}):this.showView("login")},showNewProjectView:function(e,t){this.showView("newproject")},showDashboardView:function(e,t){var n=this;this.showView("dashboard",{model:n.get("currentUser")})},handleProject:function(t,n){var r=this,i=new e.Project({_id:t.params.id});i.load(function(n,s){if(n){e.fire("alert",{type:"error",message:"Unable to load project. Please try again."});return}r.set("currentProject",i),r.save("/project/"+t.params.id+"/overview")})},showProjectView:function(e,t){this.showView("project",{model:this.get("currentProject")})},showUserView:function(e,t){this.showView("usersettings")},showEditProjectView:function(e,t){this.showView("newproject",{model:this.get("currentProject")})},showWorkflowView:function(e,t){this.showView("workflow")}},{ATTRS:{routes:{value:[{path:"/project/:id/schedule",callback:"showScheduleView"},{path:"/project/:id/resource",callback:"showResourceView"},{path:"/project/:id/gantt",callback:"showGanttView"},{path:"/login",callback:"showLoginView"},{path:"/",callback:"showLoginView"},{path:"/newproject",callback:"showNewProjectView"},{path:"/dashboard",callback:"showDashboardView"},{path:"/project/:id/edit",callback:"showEditProjectView"},{path:"/project/:id",callback:"handleProject"},{path:"/project/:id/overview",callback:"showProjectView"},{path
:"/usersettings",callback:"showUserView"},{path:"/project/:id/workflow",callback:"showWorkflowView"}]},root:{value:"/"},currentProject:{},currentUser:{},isAuthenticated:{value:!1}}})});
