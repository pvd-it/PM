<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Manage Me</title>
		<meta name="author" content="pide" />
		<style type="text/css">
			html {
				margin: 0;
				padding: 0;
			}
			
			body {
				font-family: Arial, Helvetica, sans-serif;
				font-size: 12px;
				margin: 0;
				padding: 0;
				background-color: #877DA0;
			}
			
			.yui3-app-views {
				width: 80%;
				margin: 0 auto;
			}
			
			.yui3-datatable-table {
				background-color: #5C7B91;
				width: 100%
			}
			
			.yui3-datatable-caption {
				font-size: 14px;
				font-style: normal;
				font-weight: bold;
			}
			
			.yui3-datatable {
				position: relative;
			}
		</style>
	</head>
	<body class="yui3-skin-sam">
		<script id="t-login" type="text/x-handlebars-template">
			<form>
				<h1>Login to Projects</h1>
				<p>
					<label for="username">Username</label>
					<input id="username" type="text" value="" placeholder="Username" />
				</p>
				<p>
					<label for="username">Password</label>
					<input id="password" type="password" value="" placeholder="Password" />
				</p>
				<p>
					<input type="submit" class="yui3-button" value="Let's Manage" />
				</p>
			</form>
		</script>
		<!--
			Uncomment for local development --> 
		<script src="http://127.0.0.1:8020/YUI/3.5.1/build/yui/yui.js"></script>
		<!--
		<script src="http://yui.yahooapis.com/3.5.1/build/yui/yui-min.js"></script>
		-->
		<script>
			YUI({
				/*
				 * Uncomment for local development
				*/  
				filter: 'RAW',
				
				/*
				combine: true,
				comboBase: 'http://yui.yahooapis.com/combo?',
				root: '3.5.1/build/',
				*/
				groups: {
					gallery: {
						root: '/gallery/',
						combine: true,
						comboBase: '/customjs?',
						filter: 'RAW',
						modules: {
							'gallery-event-pasted': {
								path: 'gallery-event-pasted/gallery-event-pasted.js',
								requires: ['event-synthetic']
							}
						}
					},
					
					generic: {
						root: '/generic/',
						combine: true,
						comboBase: '/customjs?',
						filter: 'RAW',
						modules: {
							'tree-model': {
								path: 'tree-model/tree-model.js',
								requires: ['model', 'arraylist', 'arraylist-add']
							},
							
							'tree-model-list': {
								path: 'tree-model-list/tree-model-list.js',
								requires: ['model-list', 'tree-model']
							},
							
							'inline-editor': {
								path: 'inline-editor/inline-editor.js',
								requires: ['event', 'node', 'widget', 'widget-position', 'widget-stack', 'widget-position-align'],
								skinnable: true
							},
							
							'datatable-navigate-key': {
								path: 'datatable-navigate/datatable-navigate-key.js',
								requires: ['event-key', 'event-focus', 'gallery-event-pasted']
							},
							
							'datatable-navigate': {
								path: 'datatable-navigate/datatable-navigate.js',
								requires: ['node', 'datatable-base', 'substitute', 'datatable-selection', 'datatable-navigate-key'],
								skinnable: true
							},
							
							'datatable-edit': {
								path: 'datatable-edit/datatable-edit.js',
								requires: ['inline-editor', 'datatable-navigate', 'datatable-mutable'],
								skinnable: true
							},
							
							'datatable-tree': {
								path: 'datatable-tree/datatable-tree.js',
								requires: ['datatable-navigate'],
								skinnable: true
							},
							
							'datatable-selection': {
								path: 'datatable-selection/datatable-selection.js',
								skinnable: true
							}
						}
					},
					
					app: {
						root: '/app/',
						combine: true,
						comboBase: '/customjs?',
						filter: 'RAW',
						modules: {
							'login-view': {
								path: 'pm-views/login-view.js',
								requires: ['view']
							},
							
							'resource-view': {
								path: 'pm-views/resource-view.js',
								requires: ['view', 'datatable-edit', 'resource-list', 'resource']
							},
							
							'schedule-view': {
								path: 'pm-views/schedule-view.js',
								requires: ['view', 'datatable-tree', 'task-list']
							},
							
							resource: {
								path: 'resource/resource.js',
								requires: ['model']
							},
							
							'resource-list': {
								path: 'resource/resource-list.js',
								requires: ['model-list', 'resource', 'io-base']
							},
							
							task: {
								path: 'task/task.js',
								requires: ['tree-model']
							},
							
							'task-list': {
								path: 'task/task-list.js',
								requires: ['tree-model-list','task', 'io-base']
							},
						}
					}
				}
			}).use('app-base', 'app-transitions', 'handlebars', 'json', 'login-view', 'schedule-view', 'resource-view', function(Y){

				Y.ProjectManagementApp = Y.Base.create('projectManagementApp', Y.App, [], {
					views: {
						login: {type: Y.PMApp.LoginView},
						schedule: {type: Y.PMApp.ScheduleView, preserve: true, parent: 'login'},
						resource: {type: Y.PMApp.ResourceView, preserve: true}
					},
					
					initializer: function(){
						this.after('*:loginSuccess', this.handleLogin);
					},
					
					handleLogin: function(){
						Y.log('loginSuccess');
						this.replace('/schedule');
					},
					
					handleSchedule: function(req, res, next){
						Y.log('handleSchedule');
						if (this.get('tasks').size() === 0){
							this.get('tasks').loadFromServer(next);
						} else {
							next();
						}
													
					},
					
					showScheduleView: function(req, res){
						Y.log('showScheduleView');
						this.showView('schedule', {
							modelList: this.get('tasks')
						});
						this.get('activeView').moveFocusToTable();
					},					
					
					handleResource: function(req, res, next){
						Y.log('handleSchedule');
						if (this.get('resources').size() === 0){
							this.get('resources').loadFromServer(next);
						} else {
							next();
						}
					},
					
					showResourceView: function(req, res){
						Y.log('showResourceView');
						this.showView('resource', {
							modelList: this.get('resources')
						});
						this.get('activeView').moveFocusToTable();
					}
				}, {
					ATTRS: {
						routes: {
							value: [
								{path: '/schedule', callback: 'handleSchedule'},
								{path: '/schedule', callback: 'showScheduleView'},
								{path: '/resource', callback: 'handleResource'},
								{path: '/resource', callback: 'showResourceView'}
							]
						},
						
						root: {
							value: '/projectmanagement/' 
						},
						
						tasks: {
							value: new Y.TaskList()
						},
						
						resources: {
							value: new Y.ResourceList()
						}
					}
				});
				
				var pmApp = new Y.ProjectManagementApp();
				pmApp.render();
				
				/* Uncomment for local development
				*/
				//pmApp.replace('/schedule');
				
				pmApp.replace('/resource');
				
				/*
				pmApp.showView('login');
				*/
			});
		</script>
	</body>
</html>