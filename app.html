<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Manage Me</title>
		<meta name="author" content="pide" />
		<style type="text/css">
			html {
				margin: 0;
				padding: 0;
			}
			
			body {
				font-family: Arial, Helvetica, sans-serif;
				font-size: 14px;
				margin: 0;
				padding: 0;
				background-color: #5c7b91;
			}
			
			.yui3-app-views {
				background-color: #d6dee2;
				width: 960px;
				margin: 0 auto;
			}
			
			.yui3-datatable-table {
				width: 100%
			}
			
			.yui3-datatable-caption {
				font-size: 14px;
				font-style: normal;
				font-weight: bold;
			}
		</style>
	</head>
	<body class="yui3-skin-sam">
		</div>
		<script id="t-login" type="text/x-handlebars-template">
			<form>
				<h1>Login to Projects</h1>
				<p>
					<label for="username">Username</label>
					<input id="username" type="text" value="" placeholder="Username" />
				</p>
				<p>
					<label for="username">Password</label>
					<input id="password" type="password" value="" placeholder="Password" />
				</p>
				<p>
					<input type="submit" class="yui3-button" value="Let's Manage" />
				</p>
			</form>
		</script>
		<script src="/YUI/3.5.0pr4/yui/yui.js"></script>
		<script>
			YUI({
				combine: false,
				filter: 'RAW',
				groups: {
					pm: {
						base: './',
						modules: {
							task: {
								path: 'task/task.js',
								requires: ['model', 'arraylist', 'arraylist-add']
							},
							
							'task-list': {
								path: 'task/task-list.js',
								requires: ['task', 'model-list', 'io-xdr']
							},
							
							'inline-editor': {
								path: 'inline-editor/inline-editor.js',
								requires: ['button', 'widget', 'widget-position', 'widget-stack', 'widget-position-align', 'node', 'event-key', 'event-outside'],
								skinnable: true
							},
							
							'datatable-edit': {
								path: 'datatable-edit/datatable-edit.js',
								requires: ['plugin', 'inline-editor'],
								skinnable: true
							}
						}
					}
				}
			}).use('app-base', 'app-transitions', 'handlebars', 'datatable-edit', 'datatable-mutable', 'event-key', 'inline-editor', 'task', 'task-list', 'json', function(Y){
				
				Y.LoginView = Y.Base.create('loginView', Y.View, [], {
					template: Y.Handlebars.compile(Y.one('#t-login').getContent()),
					
					render: function(){
						var content = this.template();
						
						this.get('container').setContent(content);
						
						return this;
					},
					
					events: {
						'form': {submit: 'doLogin'}
					},
					
					doLogin: function(e){
						Y.log('doLogin' + e);
						this.fire('loginSuccess');
						e.halt();
					}
				});
				
				Y.ScheduleView = Y.Base.create('scheduleView', Y.View, [], {
					
					events: {
						'.save': {
							click: function(e){
								this.get('modelList').persistList();
							}
						},
						
						'.print': {
							click: function(e){
								Y.log(this.get('modelList')._clientIdMap);
							}
						}
					},
					
					render: function(){
						var table = new Y.DataTable({
							tabIndex: 0,
							columns: [
								{key: 'parent',				label: 'Index',				
									formatter: function(o){
										o.value = o.rowIndex+1;
									}													},
								{key: 'parent',				label: 'T',
									formatter: function(o){
										if (o.data.children.size()) {
									 		if (o.data.collapsed){
									 			o.className += 'cell-close';
									 		} else {
									 			o.className += ' cell-open';	
									 		}
									 	}
									 	o.value = ''
									 	
									 	if (!o.data.visible){
									 		o.rowClass += ' hidden';
									 	};
									}
																						},	
								{key: 'name', 				label: 'Task Name',
								 formatter: function(o) {
								 	o.className += ' cell-depth-' + o.data.depthLevel;
								 	if (o.data.children.size()) {
								 		o.className += ' has-child';
								 	}
								 }			
																						},
								{key: 'work', 				label: 'W'	},
								{key: 'duration', 			label: 'D'	},
								{key: 'startDate', 			label: 'Start Date'			},
								{key: 'endDate', 			label: 'End Date'			},
								{key: 'isFixedDuration',	label: 'Fixed Duration'		}
							],
							caption: 'Project Schedule',
							recordType: Y.Task,
							data: this.get('modelList')
						});
				
						table.plug(Y.Plugin.DatatableEditPlugin);	
						table.render(this.get('container'));
						
						this.get('container').append('<div>' +
														'<button class="save">Save</button>' + 
														'<button class="print">Print</button>' +
													'</div>');
						table.focus();
					}
				});
				
				Y.ProjectManagementApp = Y.Base.create('projectManagementApp', Y.App, [], {
					views: {
						login: {type: 'LoginView'},
						schedule: {type: 'ScheduleView', preserve: true, parent: 'login'}
					},
					
					initializer: function(){
						this.after('*:loginSuccess', this.handleLogin);
					},
					
					handleLogin: function(){
						Y.log('loginSuccess');
						this.replace('/schedule');
					},
					
					handleSchedule: function(req, res, next){
						Y.log('handleSchedule');
						this.get('tasks').loadFromServer();
						next();
					},
					
					showScheduleView: function(req, res){
						Y.log('showScheduleView');
						this.showView('schedule', {
							modelList: this.get('tasks')
						});
					}
				}, {
					ATTRS: {
						routes: {
							value: [
								{path: '/schedule', callback: 'handleSchedule'},
								{path: '/schedule', callback: 'showScheduleView'}
							]
						},
						
						root: {
							value: '/ProjectManagement/' 
						},
						
						tasks: {
							value: new Y.TaskList()
						}
					}
				});
				
				
				//var tasks = [{"clientId":"task_7","name":"Story A6","isFixedDuration":false,"work":8,"duration":1,"depthLevel":0,"children":["task_8","task_12","task_15","task_20","task_24","task_25","task_37","task_38","task_48"],"collapsed":false,"visible":true},{"clientId":"task_8","name":"Navigation Logic","isFixedDuration":false,"work":8,"duration":1,"depthLevel":1,"parent":"task_7","children":["task_9","task_10","task_11"],"collapsed":true,"visible":true},{"clientId":"task_9","name":"Develop based on story (skeleton)","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_8","children":[],"collapsed":false,"visible":false},{"clientId":"task_10","name":"Write flow test cases","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_8","children":[],"collapsed":false,"visible":false},{"clientId":"task_11","name":"Partial offshore integration","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_8","children":[],"collapsed":false,"visible":false},{"clientId":"task_12","name":"Call up person search (P01)","isFixedDuration":false,"work":8,"duration":1,"depthLevel":1,"parent":"task_7","children":["task_13","task_14"],"collapsed":true,"visible":true},{"clientId":"task_13","name":"A6.2 mask","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_12","children":[],"collapsed":false,"visible":false},{"clientId":"task_14","name":"A6.3 Enter Search Criteria (P01)/A6.4Create new customer after review of results","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_12","children":[],"collapsed":false,"visible":false},{"clientId":"task_15","name":"A6.5 Enter Customer Data (P01)","isFixedDuration":false,"work":8,"duration":1,"depthLevel":1,"parent":"task_7","children":["task_16","task_17","task_18","task_19"],"collapsed":true,"visible":true},{"clientId":"task_16","name":"A6.5 Create Mask","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_15","children":[],"collapsed":false,"visible":false},{"clientId":"task_17","name":"A6.5 Phone number validation","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_15","children":[],"collapsed":false,"visible":false},{"clientId":"task_18","name":"A6.5 Create UI Service","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_15","children":[],"collapsed":false,"visible":false},{"clientId":"task_19","name":"A6.5 Create Business Service","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_15","children":[],"collapsed":false,"visible":false},{"clientId":"task_20","name":"A6.6 Select product category","isFixedDuration":false,"work":8,"duration":1,"depthLevel":1,"parent":"task_7","children":["task_21","task_22","task_23"],"collapsed":true,"visible":true},{"clientId":"task_21","name":"A6.6 Create Mask","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_20","children":[],"collapsed":false,"visible":false},{"clientId":"task_22","name":"A6.6 Create UI Service","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_20","children":[],"collapsed":false,"visible":false},{"clientId":"task_23","name":"A6.6 Create Business Service","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_20","children":[],"collapsed":false,"visible":false},{"clientId":"task_24","name":"Partial Onsite Integration","isFixedDuration":false,"work":8,"duration":1,"depthLevel":1,"parent":"task_7","children":[],"collapsed":false,"visible":true},{"clientId":"task_25","name":"A6.7 Configure product - Offshore","isFixedDuration":false,"work":8,"duration":1,"depthLevel":1,"parent":"task_7","children":["task_26","task_27","task_28","task_29","task_30","task_31","task_32","task_33","task_34","task_35","task_36"],"collapsed":true,"visible":true},{"clientId":"task_26","name":"Create UI Document","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_25","children":[],"collapsed":false,"visible":false},{"clientId":"task_27","name":"A6.7 Create Mask","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_25","children":[],"collapsed":false,"visible":false},{"clientId":"task_28","name":"Create Canonical Document","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_25","children":[],"collapsed":false,"visible":false},{"clientId":"task_29","name":"Create UI Service - Save","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_25","children":[],"collapsed":false,"visible":false},{"clientId":"task_30","name":"Create UI Service - Get","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_25","children":[],"collapsed":false,"visible":false},{"clientId":"task_31","name":"Prepare XSD ","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_25","children":[],"collapsed":false,"visible":false},{"clientId":"task_32","name":"Create and Mock Blaze Adaptor Service CPRSQ","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_25","children":[],"collapsed":false,"visible":false},{"clientId":"task_33","name":"Create and Mock Blaze Adaptor Service PROD","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_25","children":[],"collapsed":false,"visible":false},{"clientId":"task_34","name":"Create Business Service - Save","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_25","children":[],"collapsed":false,"visible":false},{"clientId":"task_35","name":"Create Business Service - Get","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_25","children":[],"collapsed":false,"visible":false},{"clientId":"task_36","name":"Screen Level Integration","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_25","children":[],"collapsed":false,"visible":false},{"clientId":"task_37","name":"Full Offshore Integration","isFixedDuration":false,"work":8,"duration":1,"depthLevel":1,"parent":"task_7","children":[],"collapsed":false,"visible":true},{"clientId":"task_38","name":"A6.7 Configure product - Onsite","isFixedDuration":false,"work":8,"duration":1,"depthLevel":1,"parent":"task_7","children":["task_39","task_40","task_41","task_42","task_43","task_44","task_45","task_46","task_47"],"collapsed":true,"visible":true},{"clientId":"task_39","name":"Static Document BPFV0158","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_38","children":[],"collapsed":false,"visible":false},{"clientId":"task_40","name":"Static Document BPFV0173","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_38","children":[],"collapsed":false,"visible":false},{"clientId":"task_41","name":"Static Document BPFV0179","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_38","children":[],"collapsed":false,"visible":false},{"clientId":"task_42","name":"Static Document BPFV0212","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_38","children":[],"collapsed":false,"visible":false},{"clientId":"task_43","name":"Service for BPFV0103","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_38","children":[],"collapsed":false,"visible":false},{"clientId":"task_44","name":"Service for BPF0119","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_38","children":[],"collapsed":false,"visible":false},{"clientId":"task_45","name":"Merged Document Service","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_38","children":[],"collapsed":false,"visible":false},{"clientId":"task_46","name":"Dynamic Document BPFV0103","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_38","children":[],"collapsed":false,"visible":false},{"clientId":"task_47","name":"Dynamic Document BPFV0119","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_38","children":[],"collapsed":false,"visible":false},{"clientId":"task_48","name":"Full Onsite Integration","isFixedDuration":false,"work":8,"duration":1,"depthLevel":1,"parent":"task_7","children":["task_49","task_50","task_51","task_52"],"collapsed":true,"visible":true},{"clientId":"task_49","name":"Build 36 Migration","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_48","children":[],"collapsed":false,"visible":false},{"clientId":"task_50","name":"Document Integration","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_48","children":[],"collapsed":false,"visible":false},{"clientId":"task_51","name":"UI Alignment (feeback from analyst)","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_48","children":[],"collapsed":false,"visible":false},{"clientId":"task_52","name":"Blaze Integration","isFixedDuration":false,"work":8,"duration":1,"depthLevel":2,"parent":"task_48","children":[],"collapsed":false,"visible":false}]; 
				//Y.Task.lastCount = tasks.length + 50;
				
				var pmApp = new Y.ProjectManagementApp();
				pmApp.render();
				
				Y.log(pmApp.get('root'));
				pmApp.showView('login');
			});
		</script>
	</body>
</html>